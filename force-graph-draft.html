<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <title>Force-Directed Graph</title>
        <script type="text/javascript" src="js/d3.v2.js"></script>
        <script type="text/javascript" src="js/jquery-1.8.1.js"></script>
        <script type="text/javascript" src="js/lastfmAPI/lastfm.api.md5.js"></script>
        <script type="text/javascript" src="js/lastfmAPI/lastfm.api.js"></script>
        <script type="text/javascript" src="js/lastfmAPI/lastfm.api.cache.js"></script>
        <script type="text/javascript" src="js/utils.js"></script>
        <script type="text/javascript" src="js/forceGraphVis.js"></script>
        <script type="text/javascript" src="js/lasfm_SimilarArtistsEvents.js"></script>
        <style type="text/css">

            circle.node {
                cursor: pointer;
                stroke: #000;
                stroke-width: .5px;
            }

            line.link {
                fill: none;
                stroke: #9ecae1;
                stroke-width: 1.5px;
            }
            .info{
                color: green;
                font-weight: bold;
            }
            .warning{
                color: orange;
                font-weight: bold;
            }
            .error{
                color: red;
                font-weight: bold;
            }
            div.node {
                border: 2px solid #000;
                border-radius: 6px;
                width: 12px;
                height: 12px;
                position: absolute;
                z-index: 500;
                display: table;
            }
            div.node .text{
                width: 100%;
                font-size: 10px;
                text-align: center;
                display: table-cell;
                vertical-align: middle;
            }

            div.node.group_0{
                border-color: #cc0000 !important; /*dark red tone*/
                background-color: #ff3333 !important; /*red tone*/
            }
            #chart{
                border: 2px solid;
                position: relative;
                overflow: hidden;
                width: 1024px;
                height: 580px;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -o-user-select: none;
                user-select: none;

            }
            #chartControls{
                padding: 2px;
                margin: 3px;

            }
            div.link {
                position: absolute;
                border: 1px solid #5F5F5F;
                border-style: solid;
                height: 4px;
                -webkit-transform-origin: 0 0;
                -moz-transform-origin: 0 0;
                -ms-transform-origin: 0 0;
                -o-transform-origin: 0 0;
                transform-origin: 0 0;
            }
            .float-left{
                float: left;
            }
            #output{
                padding: 5px;
            }
            .float-fix{
                clear: both;
            }
        </style>
    </head>
    <body>

        <div>
            <div>Last.fm Username:<input type="text" id="txtLastfmUsername"  value="semogj" />
                Number of Top Artists: <input id="topArtistsNumber" type="number" min="3" max="100" value="10" />             
            </div>
            <div>
                Min Similarity Value (0 - 100): <input id="minSimilarity" type="range" min="0" max="100" value ="40" disabled=""/> <span id="simVal">40</span>
                Max Similar Neighbors: <input id="maxNeighbors" type="number" min="1" max="100" value="20" disabled="" />
                <input id="btLastfmUsername" type="button" value="Fetch data from Last.fm"/> |
                <input id="btTest1" type="button" value="Use Test Data 1" /> 
                <input id="btTest2" type="button" value="Use Test Data 2" />  
                <input id="btTest3" type="button" value="Use Test Data 3" />  
            </div>
            <div id="info"></div>
        </div>
        <div>
            <div id="chart"  class="float-left"></div>
            <div id="chartControls"  class="float-left">
                <input id="btBordersLimit" type="button" value="Borders Limit: Off" />
            </div>
            <div class="float-fix"></div>
        </div>
        <div id="output">
            <p>As arestas representam relações. Os valores das relações são supostos serem normalizadores entre 0 e 1, sendo que o valor 1
                representa uma similaridade forte e 0 a "ausencia" de relação. As cores das arestas representam também a similaridade, sendo 
                utilizadas cores quentes para relações fortes e cores frias para relações fracas.</p>
            <p>O gráfico do lasfm apresenta a lista de artistas mais ouvidos pelo utilizador especificado (nós a vermelho) e os artistas
                relacionados (nós a azul). As relações representam similaridade entre artistas.</p>
            
        </div>
        <script type="text/javascript">
            var lastfmCache = new LastFMCache();
            var lastfm = new LastFM({
                apiKey: '58c14554d4b5a87e1486bdff11b44e11',
                apiSecret: '0d3d27ec57beea0bbaa341f45cce9dfb',
                cache: lastfmCache});
            $('#minSimilarity').change(function(e){
                $('simVal').text($('minSimilarity').val());
            })
            $('#btLastfmUsername').click(lastfm_fetchInfoEvent);
            $('#txtLastfmUsername').keydown(function(e) {
                if(e.keyCode == 13) {
                    e.preventDefault();
                    fetchInfoEvent();
                }
            });
            var bordersLimit = false;
            var graphObj = null;
            $('#btBordersLimit').click(function(e){
                bordersLimit = !bordersLimit;
                $('#btBordersLimit').val("Border Limit : " + (bordersLimit ? "On" : "Off"));
                if(isset(graphObj)){
                    graphObj.stop();
                    graphObj.bordersLimit = bordersLimit;
                    graphObj.tick();
                    graphObj.start();
                }
            })
            $('#btTest1').click(testData1Event);
            $('#btTest2').click(testData2Event);
            $('#btTest3').click(testData3Event);
            var settings = {
                defaultTopArtists : 10,
                defaultSimilarArtists : 50,
                matchMinimum: 0.4
            }
            function testData1Event(event){
                graphObj = updateVisualization([{name:'A'}, {name:'B'},{name:'C'}, {name:'D'}, {name:'E'} ,{name:'F'}, {name:'G'}, {name:'H'},{name:'I'},{name:'J'}],
                [{source:0, target:1, value:1},{source:0, target:2, value:1},{source:0, target:3, value:0.1},
                    {source:0, target:4, value:0},{source:0, target:5, value:0.6},{source:0, target:6, value:0.5},
                    {source:0, target:7, value:0.5},{source:0, target:8, value:0.5},{source:0, target:9, value:0.5}],
                {width: 1024, height: 540, gravity: 0.08, radius: 20, charge:-100, defaultLinkDistance: 50, 
                    minLinkDistance:12, maxLinkDistance:130, bordersLimit:bordersLimit});
            }
            
            function testData2Event(event){
                var nodes = [
                    {name: "Sound Event 1", locked:true, nodeGroup:0, bordersLimit:true}, //0
                    {name: "Similar Event: 1.0"}, //1
                    {name: "Similar Event: 1.0"}, //2
                    {name: "Similar Event: 1.0"}, //3
                    {name: "Similar Event: 1.0"}, //4
                    {name: "Similar Event: 0.8"}, //5
                    {name: "Similar Event: 0.8"}, //6
                    {name: "Similar Event: 0.8"}, //7
                    {name: "Similar Event: 0.7"}, //8
                    {name: "Similar Event: 0.5"}, //9
                    {name: "Similar Event: 0.5"}, //10
                    {name: "Similar Event: 0.5"}, //11
                    {name: "Similar Event: 0.5"}, //12
                    {name: "Similar Event: 0.5"}, //13
                    {name: "Similar Event: 0.1"},  //14
                    {name: "Similar Event: 0.1"},  //15
                    {name: "Similar Event: 0.8"},  //16
                    {name: "Similar Event: 0.8"},  //17
                    {name: "Similar Event: 0.8"},  //18
                    {name: "Similar Event: 1.0"},  //19
                    {name: "Similar Event: 0.95"},  //20
                    {name: "Similar Event: 0.7"},  //21
                    {name: "Similar Event: 0.8"},  //22
                    {name: "Similar Event: 0.8"},  //23
                ];
                var links = [
                    {source:0, target:1, value:1.0},
                    {source:0, target:2, value:1.0},
                    {source:0, target:3, value:1.0},
                    {source:0, target:4, value:1.0},
                    {source:0, target:5, value:0.8},
                    {source:0, target:6, value:0.8},
                    {source:0, target:7, value:0.8},
                    {source:0, target:8, value:0.7},
                    {source:0, target:9, value:0.5},
                    {source:0, target:10, value:0.5},
                    {source:0, target:11, value:0.5},
                    {source:0, target:12, value:0.5},
                    {source:0, target:13, value:0.5},
                    {source:0, target:14, value:0.1},
                    {source:0, target:15, value:0.1},
                    {source:0, target:16, value:0.8},
                    {source:0, target:17, value:0.8},
                    {source:0, target:18, value:0.8},
                    {source:0, target:19, value:1.0},
                    {source:0, target:20, value:0.95},
                    {source:0, target:21, value:0.7},
                    {source:0, target:22, value:0.8},
                    {source:0, target:23, value:0.8},
                ];
                var config = {width: 1024, height: 540, gravity: 0.01, radius: 20, charge:-100, 
                    defaultLinkDistance: 50, minLinkDistance:10, maxLinkDistance:160, bordersLimit:bordersLimit};
                graphObj = updateVisualization(nodes, links, config);
            }
            function testData3Event(event){
                var nodes = [
                    {name: "Sound Event 1", locked:true, nodeGroup:0, bordersLimit:true}, //0
                    {name: "Similar Event: 1.0"}, //1
                    {name: "Similar Event: 1.0"}, //2
                    {name: "Similar Event: 1.0"}, //3
                    {name: "Similar Event: 1.0"}, //4
                    {name: "Similar Event: 0.8"}, //5
                    {name: "Similar Event: 0.8"}, //6
                    {name: "Similar Event: 0.8"}, //7
                    {name: "Similar Event: 0.7"}, //8
                    {name: "Similar Event: 0.5"}, //9
                    {name: "Similar Event: 0.5"}, //10
                    {name: "Similar Event: 0.5"}, //11
                    {name: "Similar Event: 0.5"}, //12
                    {name: "Similar Event: 0.5"}, //13
                    {name: "Similar Event: 0.1"},  //14
                    {name: "Similar Event: 0.1"},  //15
                    {name: "Similar Event: 0.8"},  //16
                    {name: "Similar Event: 0.8"},  //17
                    {name: "Similar Event: 0.8"},  //18
                    {name: "Similar Event: 1.0"},  //19
                    {name: "Similar Event: 0.95"},  //20
                    {name: "Similar Event: 0.7"},  //21
                    {name: "Similar Event: 0.8"},  //22
                    {name: "Similar Event: 0.8"},  //23
                    {name: "Big Node", nodeGroup:0},  //24
                    {name: "Big Node", nodeGroup:0},  //25
                    {name: "Big Node", nodeGroup:0},  //26
                    {name: "Big Node", nodeGroup:0},  //27
                    {name: "Big Node", nodeGroup:0},  //28
                    {name: "Big Node", nodeGroup:0},  //29
                    {name: "Big Node", nodeGroup:0},  //30
                ];
                var bigNodeLinkMult = 1.25;
                var links = [
                    {source:0, target:1, value:1.0},
                    {source:0, target:2, value:1.0},
                    {source:0, target:3, value:1.0},
                    {source:0, target:4, value:1.0},
                    {source:0, target:5, value:0.8},
                    {source:0, target:6, value:0.8},
                    {source:0, target:7, value:0.8},
                    {source:0, target:8, value:0.7},
                    {source:0, target:9, value:0.5},
                    {source:0, target:10, value:0.5},
                    {source:0, target:11, value:0.5},
                    {source:0, target:12, value:0.5},
                    {source:0, target:13, value:0.5},
                    {source:0, target:14, value:0.1},
                    {source:0, target:15, value:0.1},
                    {source:0, target:16, value:0.8},
                    {source:0, target:17, value:0.8},
                    {source:0, target:18, value:0.8},
                    {source:0, target:19, value:1.0},
                    {source:0, target:20, value:0.95},
                    {source:0, target:21, value:0.7},
                    {source:0, target:22, value:0.8},
                    {source:0, target:23, value:0.8},
                    {source:0, target:24, value:0, lengthMult:bigNodeLinkMult},
                    {source:0, target:25, value:0, lengthMult:bigNodeLinkMult},
                    {source:0, target:26, value:0, lengthMult:bigNodeLinkMult},
                    {source:0, target:27, value:0, lengthMult:bigNodeLinkMult},
                    {source:0, target:28, value:0, lengthMult:bigNodeLinkMult},
                    {source:0, target:29, value:0, lengthMult:bigNodeLinkMult},
                    {source:0, target:30, value:0, lengthMult:bigNodeLinkMult},
                ];
                var config = {width: 1024, height: 540, gravity: 0.035, radius: 20, charge:-110, 
                    defaultLinkDistance: 50, minLinkDistance:10, maxLinkDistance:160, bordersLimit:bordersLimit};
                graphObj = updateVisualization(nodes, links, config);
            }
       
            function updateVisualization(nodes, links, config){
                setInfo(nodes.length + ' nodes and '+ links.length + ' connection. Rendering visualization...');
                console.log(nodes);
                console.log(links);
                $('#btLastfmUsername').removeAttr('disabled');
                
                config = issetDefault(config, {width: 1024, height: 540, gravity: 0.08, radius: 20, charge:-100, 
                    defaultLinkDistance: 50, minLinkDistance:12, maxLinkDistance:130});
                var graphObj = create_force_visualization("#chart", config);
                init_visualization(graphObj, nodes, links);
                return graphObj;
            }
            
            function setInfo(msg, type){
                var infoBox = $('#info').removeClass();
                switch(type){
                    case 'error':
                        infoBox.addClass('error');
                    case 'warning':
                        infoBox.addClass('warning');
                    default:
                        infoBox.addClass('info');
                }
                infoBox.text(msg);
                
            }

        </script>
    </body>
</html>
